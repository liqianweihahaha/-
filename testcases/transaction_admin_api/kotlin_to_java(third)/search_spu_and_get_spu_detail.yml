- config:
    name: 查询spu-获取指定spu详情
    base_url: ${ENV(transaction_admin_api_host)}
    variables:
        - existed_category_id: 1
        - existed_department_id: 1
        - existed_number: 2
        - existed_status: "DELETED"
        - existed_title: ${gen_random_string(10)}
        - existed_type: VIRTUAL
        - unexisted_type: aaa
        - unexisted_title: ${gen_random_string(61)}
        - unexisted_category_id: 11111
        - unexisted_department_id: 100000
        - unexisted_spu_number: G11111


- test:
    skipIf: ${is_production()}
    name: 已登录内部账号-查询spu-不带任何查询条件
    request:
        method: GET
        url: /products/spu/search
        headers:
            Authorization: ${internal_source_user_login_token()}
    validate:
        - eq: [status_code, 200]
        - type_match: [content, object]
        - type_match: [content.items, list]
        - length_equals: [content.items.0, 16]       
        - contains: [content, total]
    extract:
        - spu_number: content.items.0.spu_number


- test:
    skipIf: ${is_production()}
    name: 已登录内部账号-查询spu-通过spu_number查询-spu_number存在-有数据返回
    request:
        method: GET
        url: /products/spu/search?spu_number=$spu_number
        headers:
            Authorization: ${internal_source_user_login_token()}
    validate:
        - eq: [status_code, 200]
        - type_match: [content, object]
        - type_match: [content.items, list]
        - length_equals: [content.items, 1]  

- test:
    skipIf: ${is_production()}
    name: 已登录内部账号-查询spu-通过spu_number查询-spu_number不存在-返回空
    request:
        method: GET
        url: /products/spu/search?spu_number=$unexisted_spu_number
        headers:
            Authorization: ${internal_source_user_login_token()}
    validate:
        - eq: [status_code, 200]
        - type_match: [content, object]
        - type_match: [content.items, list]
        - length_equals: [content.items, 0] 

- test:
    skipIf: ${is_production()}
    name: 已登录内部账号-查询spu-通过department_number查询-department_number存在-有数据返回
    request:
        method: GET
        url: /products/spu/search?department_number=$existed_department_id
        headers:
            Authorization: ${internal_source_user_login_token()}
    validate:
        - eq: [status_code, 200]
        - type_match: [content, object]
        - type_match: [content.items, list]

- test:
    skipIf: ${is_production()}
    name: 已登录内部账号-查询spu-通过department_number查询-department_number不存在-返回空
    request:
        method: GET
        url: /products/spu/search?department_number=$unexisted_department_id
        headers:
            Authorization: ${internal_source_user_login_token()}
    validate:
        - eq: [status_code, 200]
        - type_match: [content, object]
        - type_match: [content.items, list]
        - length_equals: [content.items, 0] 

- test:
    skipIf: ${is_production()}
    name: 已登录内部账号-查询spu-通过category_number查询-category_number存在-有数据返回
    request:
        method: GET
        url: /products/spu/search?category_number=$existed_category_id
        headers:
            Authorization: ${internal_source_user_login_token()}
    validate:
        - eq: [status_code, 200]
        - type_match: [content, object]
        - type_match: [content.items, list]

- test:
    skipIf: ${is_production()}
    name: 已登录内部账号-查询spu-通过category_number查询-category_number不存在-返回空
    request:
        method: GET
        url: /products/spu/search?category_number=$unexisted_category_id
        headers:
            Authorization: ${internal_source_user_login_token()}
    validate:
        - eq: [status_code, 200]
        - type_match: [content, object]
        - type_match: [content.items, list]  

- test:
    skipIf: ${is_production()}
    name: 已登录内部账号-查询spu-通过status查询-status存在-有数据返回
    request:
        method: GET
        url: /products/spu/search?status=VISIBLE
        headers:
            Authorization: ${internal_source_user_login_token()}
    validate:
        - eq: [status_code, 200]
        - type_match: [content, object]
        - type_match: [content.items, list]

- test:
    skipIf: ${is_production()}
    name: 已登录内部账号-查询spu-通过status查询-status不存在-接口报错400
    request:
        method: GET
        url: /products/spu/search?status=aaa
        headers:
            Authorization: ${internal_source_user_login_token()}
    validate:
        - eq: [status_code, 400]

- test:
    skipIf: ${is_production()}
    name: 已登录内部账号-查询spu-通过title查询-title存在
    request:
        method: GET
        url: /products/spu/search?title=测试
        headers:
            Authorization: ${internal_source_user_login_token()}
    validate:
        - eq: [status_code, 200]
        - type_match: [content, object]
        - type_match: [content.items, list] 

- test:
    skipIf: ${is_production()}
    name: 已登录内部账号-查询spu-通过title查询-title不存在
    request:
        method: GET
        url: /products/spu/search?title=aaaaaaa
        headers:
            Authorization: ${internal_source_user_login_token()}
    validate:
        - eq: [status_code, 200]
        - type_match: [content, object]
        - type_match: [content.items, list]
        - length_equals: [content.items, 0] 

- test:
    skipIf: ${is_production()}
    name: 未登录内部账号-查询spu
    request:
        method: GET
        url: /products/spu/search
    validate:
        - eq: [status_code, 401]
        - eq: [content.error_code, '10020005']


- test:
    skipIf: ${is_production()}
    name: 已登录内部账号-获取指定spu详情-spu_number存在
    request:
        method: GET
        url: /products/spu/$spu_number/details
        headers:
            Authorization: ${internal_source_user_login_token()}
    validate:
        - eq: [status_code, 200]
        - type_match: [content, object]
        - length_equals: [content, 21] 

- test:
    skipIf: ${is_production()}
    name: 已登录内部账号-获取指定spu详情-spu_number不存在
    request:
        method: GET
        url: /products/spu/$unexisted_spu_number/details
        headers:
            Authorization: ${internal_source_user_login_token()}
    validate:
        - eq: [status_code, 200]


- test:
    skipIf: ${is_production()}
    name: 未登录内部账号-获取指定spu详情-spu_number存在
    request:
        method: GET
        url: /products/spu/$spu_number/details
    validate:
        - eq: [status_code, 401]
        - eq: [content.error_code, '10020005']

- test:
    skipIf: ${is_production()}
    name: 已登录内部账号-删除spu-spuNumber存在-删除成功
    request:
        method: PATCH
        url: /products/spu/$spu_number/status
        headers:
            Authorization: ${internal_source_user_login_token()}
        json:
            status: 'DELETED'
    validate:
        - eq: [status_code, 200]