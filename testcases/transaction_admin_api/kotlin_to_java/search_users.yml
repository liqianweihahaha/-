- config:
    name: 根据姓名模糊搜索用户
    base_url: ${ENV(transaction_admin_api_host)}
    verify: False
    variables:
        - existed_name: '聂'
        - unexist_name: 'testtest'

- test:
    name: 已登录内部账号系统-搜索用户-未传name参数
    request:
        method: GET
        url: /account/users/fuzzy/search
        headers:
            Authorization: ${internal_source_user_login_token()}
    validate:
        - eq: [status_code, 400]
        - eq: [content.error_code, 'Param-Invalid@Common']

- test:
    name: 已登录内部账号系统-搜索用户-name参数存在-有数据返回
    request:
        method: GET
        url: /account/users/fuzzy/search?name=$existed_name
        headers:
            Authorization: ${internal_source_user_login_token()}
    validate:
        - eq: [status_code, 200]
        - type_match: [content, list]
        - length_equals: [content.0, 3]
        - contains: [content.0, 'userId']
        - contains: [content.0, 'userName']
        - contains: [content.0, 'email']

- test:
    name: 已登录内部账号系统-搜索用户-name参数不存在-无数据返回
    request:
        method: GET
        url: /account/users/fuzzy/search?name=$unexist_name
        headers:
            Authorization: ${internal_source_user_login_token()}
    validate:
        - eq: [status_code, 200]
        - type_match: [content, list]
        - length_equals: [content, 0]


- test:
    name: 未登录内部账号系统-搜索用户-name参数存在
    request:
        method: GET
        url: /account/users/fuzzy/search?name=$existed_name
    validate:
        - eq: [status_code, 401]
        - eq: [content.error_code, '10020005']