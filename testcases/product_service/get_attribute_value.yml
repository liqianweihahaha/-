- config:
    name: 查询属性值
    base_url: ${product_service_host()}
    variables:
        - unexisted_attribute_value_id: 100000
        - unexisted_attribute_id: 100000
        - existed_attributes_value_id1: 1

- test:
    name: 准备工作-创建属性
    request:
        method: POST
        url: /attributes
        headers:
            Content-Type: application/json
        json:
            name: ${attribute_name()}
    validate:
        - eq: [status_code, 200]
    extract:
        - create_attribute_status: status_code
        - create_attribute_id: content

- test:
    name: 准备工作-创建某属性的属性值
    skipUnless: ${eval_equal($create_attribute_status, 200)}
    request:
        method: POST
        url: /attributes/values
        headers:
            Content-Type: application/json
        json:
            attribute_id: $create_attribute_id
            name: ${attibute_value_name()}
    validate:
        - eq: [status_code, 200]
    extract:
        - create_attribute_value_id: content
        - create_attribute_value_status: status_code

- test:
    name: 根据属性ids批量获取属性值列表-ids长度为1，存在
    skipUnless: ${eval_equal($create_attribute_status, 200)}
    skipif: ${eval_equal($create_attribute_value_status, None)}
    request:
        method: GET
        url: /attributes/values?ids=$create_attribute_value_id
        headers:
            Content-Type: application/json
    validate:
        - eq: [status_code, 200]
        - length_equals: [content,1]
        - type_match: [content,list]
        - eq: [content.0.attribute_id,$create_attribute_id]

- test:
    name: 根据属性ids批量获取属性值列表-ids长度为2，两个都存在
    skipUnless: ${eval_equal($create_attribute_status, 200)}
    skipif: ${eval_equal($create_attribute_value_status, None)}
    request:
        method: GET
        url: /attributes/values?ids=1,$create_attribute_value_id
        headers:
            Content-Type: application/json
    validate:
        - eq: [status_code, 200]
        - length_equals: [content,2]
        - type_match: [content,list]
        - eq: [content.0.id,1]
        - eq: [content.1.id,$create_attribute_value_id]
        - eq: [content.1.attribute_id,$create_attribute_id]

- test:
    name: 根据属性ids批量获取属性值列表-ids长度为1，不存在
    request:
        method: GET
        url: /attributes/values?ids=$unexisted_attribute_value_id
        headers:
            Content-Type: application/json
    validate:
        - eq: [status_code, 200]
        - length_equals: [content,0]
        - type_match: [content,list]

- test:
    name: 根据属性ids批量获取属性值列表-ids为空
    request:
        method: GET
        url: /attributes/values?ids=
        headers:
            Content-Type: application/json
    validate:
        - eq: [status_code, 400]

- test:
    name: 根据属性ids批量获取属性值列表-ids长度为2，一个存在，一个不存在
    request:
        method: GET
        url: /attributes/values?ids=$create_attribute_value_id,$unexisted_attribute_value_id
        headers:
            Content-Type: application/json
    validate:
        - eq: [status_code, 200]
        - length_equals: [content,1]
        - type_match: [content,list]
        - eq: [content.0.id,$create_attribute_value_id]
        - eq: [content.0.attribute_id,$create_attribute_id]

- test:
    name: 获取某属性的所有属性值列表-attribute_id存在
    skipUnless: ${eval_equal($create_attribute_status, 200)}
    request:
        method: GET
        url: /attributes/$create_attribute_id/values/all
        headers:
            Content-Type: application/json
    validate:
        - eq: [status_code, 200]
        - length_equals: [content,1]
        - type_match: [content,list]
        - eq: [content.0.id,$create_attribute_value_id]
        - eq: [content.0.attribute_id,$create_attribute_id]

- test:
    name: 获取某属性的所有属性值列表-attribute_id不存在
    skipUnless: ${eval_equal($create_attribute_status, 200)}
    request:
        method: GET
        url: /attributes/$unexisted_attribute_id/values/all
        headers:
            Content-Type: application/json
    validate:
        - eq: [status_code, 200]
        - length_equals: [content,0]
        - type_match: [content,list]

- test:
    name: 获取某属性的所有属性值列表-attribute_id为空
    skipUnless: ${eval_equal($create_attribute_status, 200)}
    request:
        method: GET
        url: /attributes//values/all
        headers:
            Content-Type: application/json
    validate:
        - eq: [status_code, 405]