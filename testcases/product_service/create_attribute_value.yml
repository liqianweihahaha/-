- config:
    name: 创建、更新某个属性的属性值
    base_url: ${get_product_service_host()}
    variables:
        - unexisted_attribute_value_id: 10000
#    export:
#        - created_attributesId1

- test:
    name: 创建属性（拿到属性id传给后面的用例）
    request:
        method: POST
        url: /attributes
        headers:
            Content-Type: application/json
        json:
            name: ${attribute_name()}
    validate:
        - eq: [status_code, 200]
    extract:
        - create_attribute_code: status_code
        - create_attribute_id: content

- test:
    name: 创建某属性的属性值-id存在，name正确
    skipUnless: ${eval_equal($create_attribute_code, 200)}
    request:
        method: POST
        url: /attributes/values
        headers:
            Content-Type: application/json
        json:
            attribute_id: $create_attribute_id
            name: ${attibute_value_name()}
    validate:
        - eq: [status_code, 200]
    extract:
        - create_attribute_value_code: status_code
        - create_attribute_value_id: content

- test:
    name: 根据属性ids批量获取属性值列表
    request:
        method: GET
        url: /attributes/values?ids=$create_attribute_value_id
        headers:
            Content-Type: application/json
    validate:
        - eq: [status_code, 200]
        - length_equals: [content,1]
        - type_match: [content,list]
        - eq: [content.0.attribute_id,$create_attribute_id]
    extract:
        - attribute_value_name1: content.0.name

- test:
    name: 创建某属性的属性值-id存在，name:该属性ID下已存在同名属性值
    request:
        method: POST
        url: /attributes/values
        headers:
            Content-Type: application/json
        json:
            attribute_id: $create_attribute_id
            name: $attribute_value_name1
    validate:
        - eq: [status_code, 500]

- test:
    name: 创建某属性的属性值-id不存在，name正确
    request:
        method: POST
        url: /attributes/values
        headers:
            Content-Type: application/json
        json:
            attribute_id: $unexisted_attribute_value_id
            name: ${attibute_value_name()}
    validate:
        - eq: [status_code, 422]

- test:
    name: 创建某属性的属性值-id存在，name为空
    request:
        method: POST
        url: /attributes/values
        headers:
            Content-Type: application/json
        json:
            attribute_id: $create_attribute_id
            name: ''
    validate:
        - eq: [status_code, 400]

- test:
    name: 创建某属性的属性值-id存在，name的长度超过40
    request:
        method: POST
        url: /attributes/values
        headers:
            Content-Type: application/json
        json:
            attribute_id: $create_attribute_id
            name: ${generate_random_str(41)}
    validate:
        - eq: [status_code, 500]


- test:
    name: 更新某属性的属性值-id存在，name不同于当前属性id下的其它属性名称
    skipUnless: ${eval_equal($create_attribute_code, 200)}
    skipif: ${eval_equal($create_attribute_value_code, None)}
    request:
        method: PUT
        url: /attributes/values/$create_attribute_value_id
        headers:
            Content-Type: application/json
        json:
            name: ${generate_random_str(8)}
    validate:
        - eq: [status_code, 200]
        - eq: [content, true]

- test:
    name: 创建某属性的属性值-同属性id下创建另一个属性值（服务下个用例）
    skipUnless: ${eval_equal($create_attribute_code, 200)}
    request:
        method: POST
        url: /attributes/values
        headers:
            Content-Type: application/json
        json:
            attribute_id: $create_attribute_id
            name: ${attibute_value_name()}test
    validate:
        - eq: [status_code, 200]

- test:
    name: 更新某属性的属性值-id存在，name同于当前属性id下的其它属性名称
    skipUnless: ${eval_equal($create_attribute_code, 200)}
    skipif: ${eval_equal($create_attribute_value_code, None)}
    request:
        method: PUT
        url: /attributes/values/$create_attribute_value_id
        headers:
            Content-Type: application/json
        json:
            name: ${attibute_value_name()}test
    validate:
        - eq: [status_code, 500]

- test:
    name: 更新某属性的属性值-id存在，name同于其它属性id下的其它属性名称
    skipUnless: ${eval_equal($create_attribute_code, 200)}
    skipif: ${eval_equal($create_attribute_value_code, None)}
    request:
        method: PUT
        url: /attributes/values/$create_attribute_value_id
        headers:
            Content-Type: application/json
        json:
            name: '100课时'
    validate:
        - eq: [status_code, 200]
        - eq: [content, true]

- test:
    name: 更新某属性的属性值-id存在，name的长度超过40
    skipUnless: ${eval_equal($create_attribute_code, 200)}
    skipif: ${eval_equal($create_attribute_value_code, None)}
    request:
        method: PUT
        url: /attributes/values/$create_attribute_value_id
        headers:
            Content-Type: application/json
        json:
            name: ${generate_random_str(41)}
    validate:
        - eq: [status_code, 400]

- test:
    name: 更新某属性的属性值-id不存在，name正确
    request:
        method: PUT
        url: /attributes/values/$unexisted_attribute_value_id
        headers:
            Content-Type: application/json
        json:
            name: ${generate_random_str(8)}
    validate:
        - eq: [status_code, 200]
        - eq: [content, false]