- config:
    name: 创建普通订单
    base_url: ${ENV(order_service_host)}
    variables:
        - test_phone_number: ${test_phone_number()}

# 避免创建订单和获取订单详情，手机号对应客户ID不一致导致报错。
# - test:
#     name: 准备工作：注册手机号
#     setup_hooks:
#         - ${clear_phone_number($test_phone_number)}
#     api: api/platform-account/register_phone_number.yaml
#     variables:
#         - phone_number: $test_phone_number
#     validate:
#         - eq: [status_code, 200]

- test:
    skipIf: ${is_production()}
    name: 创建代下单全款订单：sku对应spu已上架-客户存在-优惠金额不传递
    request:
        method: POST
        url: /orders/admin
        json:
            placedById: 1
            renewed: 0
            placedMethod: BY_ADMIN
            paymentOption: FULL
            customerInfo:
                customerPhoneNumber: $test_phone_number
            productInfo: 
                - 
                    skuNumber: ${sku_number_config()}
                    quantity: 1
            businessTypeId: 1
            businessUnitId: 1
            shippingInfo:
                consigneeId: ''
                consignee: '马晓倩'
                phoneNumber: $test_phone_number
                province: ''
                city: ''
                district: ''
                streetAddress: ''
            remark: 测试创建订单
    validate:
        - eq: [status_code, 200]
        - contains: [content, orderId]
    extract:
        - created_orderId1: content.orderId

- test:
    skipIf: ${is_production()}
    name: 获取订单详情-订单ID存在(代下单全款订单)
    request:
        method: GET
        url: /orders/$created_orderId1
    validate:
        - eq: [status_code, 200]
        - length_equals: [content, 39]
        - eq: [content.orderId, $created_orderId1]
        - eq: [content.placedMethod, '2']
        - eq: [content.paymentOption, '3']
        - eq: [content.renewed, 0]
        - eq: [content.customerPhoneNumber, $test_phone_number]
        - eq: [content.totalDiscount, 0.00]
        - eq: [content.originalTotal, '${sku_price_config()}']
        - eq: [content.subtotal, '${sku_price_config()}']
        - eq: [content.total, '${sku_price_config()}']

# - test:
#     name: 创建代下单全款订单：sku对应spu已上架-客户存在-优惠金额传递0.99
#     request:
#         method: POST
#         url: /orders/admin
#         json:
#             placedById: 1
#             renewed: 0
#             placedMethod: BY_ADMIN
#             paymentOption: FULL
#             customerInfo:
#                 customerPhoneNumber: $test_phone_number
#             productInfo:
#                 - 
#                     skuNumber: ${sku_number_config()}
#                     quantity: 1
#             totalDiscount: 0.99
#             businessTypeId: 1
#             businessUnitId: 1
#             shippingInfo:
#                 consigneeId: ''
#                 consignee: '马晓倩'
#                 phoneNumber: $test_phone_number
#                 province: ''
#                 city: ''
#                 district: ''
#                 streetAddress: ''
#             remark: 测试创建订单
#     validate:
#         - eq: [status_code, 200]
#         - contains: [content, orderId]
#     extract:
#         - created_orderId2: content.orderId

# - test:
#     name: 获取订单详情-订单ID存在(代下单全款订单)
#     request:
#         method: GET
#         url: /orders/$created_orderId2
#     variables:
#         - expected_subtotal: ${sku_price_config()} - 0.99
#     validate:
#         - eq: [status_code, 200]
#         - length_equals: [content, 39]
#         - eq: [content.orderId, $created_orderId2]
#         - eq: [content.placedMethod, '2']
#         - eq: [content.paymentOption, '3']
#         - eq: [content.renewed, 0]
#         - eq: [content.customerPhoneNumber, $test_phone_number]
#         - eq: [content.totalDiscount, 0.99]
#         - eq: [content.originalTotal, '${sku_price_config()}']
#         - eq: [content.subtotal, $expected_subtotal]
#         - eq: [content.total, $expected_subtotal]